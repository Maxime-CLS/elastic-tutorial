<!doctype html><html lang=en class="js csstransforms3d">
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.92.2">
<meta name=description content="Tutoriel sur Elastic">
<meta name=author content="Maxime Calves">
<link rel=icon href=/elastic-tutorial/images/favicon.png type=image/png>
<title>Lab - Diagnostic :: Elastic Tutoriel</title>
<link href=/elastic-tutorial/css/nucleus.css?1645973180 rel=stylesheet>
<link href=/elastic-tutorial/css/fontawesome-all.min.css?1645973180 rel=stylesheet>
<link href=/elastic-tutorial/css/hybrid.css?1645973180 rel=stylesheet>
<link href=/elastic-tutorial/css/featherlight.min.css?1645973180 rel=stylesheet>
<link href=/elastic-tutorial/css/perfect-scrollbar.min.css?1645973180 rel=stylesheet>
<link href=/elastic-tutorial/css/auto-complete.css?1645973180 rel=stylesheet>
<link href=/elastic-tutorial/css/atom-one-dark-reasonable.css?1645973180 rel=stylesheet>
<link href=/elastic-tutorial/css/theme.css?1645973180 rel=stylesheet>
<link href=/elastic-tutorial/css/tabs.css?1645973180 rel=stylesheet>
<link href=/elastic-tutorial/css/hugo-theme.css?1645973180 rel=stylesheet>
<link href=/elastic-tutorial/css/theme-blue.css?1645973180 rel=stylesheet>
<script src=/elastic-tutorial/js/jquery-3.3.1.min.js?1645973180></script>
<style>:root #header+#content>#left>#rlblock_left{display:none!important}</style>
</head>
<body data-url=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/diagnostic/>
<nav id=sidebar class=showVisitedLinks>
<div id=header-wrapper>
<div id=header>
<img src=../../../../elastic-tutorial/media/logo.png>
</div>
<div class=searchbox>
<label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span>
</div>
<script type=text/javascript src=/elastic-tutorial/js/lunr.min.js?1645973180></script>
<script type=text/javascript src=/elastic-tutorial/js/auto-complete.js?1645973180></script>
<script type=text/javascript>var baseurl="https://maxime-cls.github.io/elastic-tutorial/"</script>
<script type=text/javascript src=/elastic-tutorial/js/search.js?1645973180></script>
</div>
<div class=highlightable>
<ul class=topics>
<li data-nav-id=/elastic-tutorial/elastic/ title=Elastic class="dd-item
parent">
<a href=/elastic-tutorial/elastic/>
Elastic
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/elastic-tutorial/elastic/prerequis/ title=Prérequis class=dd-item>
<a href=/elastic-tutorial/elastic/prerequis/>
Prérequis
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/elastic-tutorial/elastic/prerequis/installation/ title=Installation class=dd-item>
<a href=/elastic-tutorial/elastic/prerequis/installation/>
Installation
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/elastic-tutorial/elastic/d%C3%A9butant/ title=Débutant class=dd-item>
<a href=/elastic-tutorial/elastic/d%C3%A9butant/>
Débutant
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/elastic-tutorial/elastic/d%C3%A9butant/lab_logs/ title="Lab - Logs" class=dd-item>
<a href=/elastic-tutorial/elastic/d%C3%A9butant/lab_logs/>
Lab - Logs
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/elastic-tutorial/elastic/d%C3%A9butant/lab_metrics/ title="Lab - Metrics" class=dd-item>
<a href=/elastic-tutorial/elastic/d%C3%A9butant/lab_metrics/>
Lab - Metrics
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/elastic-tutorial/elastic/d%C3%A9butant/lab_apm/ title="Lab - APM" class=dd-item>
<a href=/elastic-tutorial/elastic/d%C3%A9butant/lab_apm/>
Lab - APM
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/elastic-tutorial/elastic/d%C3%A9butant/lab_uptime/ title="Lab - Uptime" class=dd-item>
<a href=/elastic-tutorial/elastic/d%C3%A9butant/lab_uptime/>
Lab - Uptime
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/ title=Elementaire class="dd-item
parent">
<a href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/>
Elementaire
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/security/ title="Lab - Habilitation" class=dd-item>
<a href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/security/>
Lab - Habilitation
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/ilm/ title="Lab - Index Lifecycle Policy" class=dd-item>
<a href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/ilm/>
Lab - Index Lifecycle Policy
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/backup/ title="Lab - Backup & Restore" class=dd-item>
<a href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/backup/>
Lab - Backup & Restore
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/diagnostic/ title="Lab - Diagnostic" class="dd-item active">
<a href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/diagnostic/>
Lab - Diagnostic
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/elastic-tutorial/elastic/intermediare/ title=Intermediare class=dd-item>
<a href=/elastic-tutorial/elastic/intermediare/>
Intermediare
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/elastic-tutorial/elastic/intermediare/alerting/ title="Lab - Alertes" class=dd-item>
<a href=/elastic-tutorial/elastic/intermediare/alerting/>
Lab - Alertes
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/elastic-tutorial/elastic/intermediare/index_alias/ title="Labs - Index et ALias" class=dd-item>
<a href=/elastic-tutorial/elastic/intermediare/index_alias/>
Labs - Index et ALias
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/elastic-tutorial/elastic/intermediare/mapping/ title="Labs - Mapping" class=dd-item>
<a href=/elastic-tutorial/elastic/intermediare/mapping/>
Labs - Mapping
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/elastic-tutorial/elastic/intermediare/template_mapping/ title="Labs - Index Template et Mapping" class=dd-item>
<a href=/elastic-tutorial/elastic/intermediare/template_mapping/>
Labs - Index Template et Mapping
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/elastic-tutorial/elastic/intermediare/reindex/ title="Labs - Reindex" class=dd-item>
<a href=/elastic-tutorial/elastic/intermediare/reindex/>
Labs - Reindex
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/elastic-tutorial/elastic/intermediare/crud_documents/ title="Labs - CRUD" class=dd-item>
<a href=/elastic-tutorial/elastic/intermediare/crud_documents/>
Labs - CRUD
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/elastic-tutorial/elastic/avance/ title=Avancé class=dd-item>
<a href=/elastic-tutorial/elastic/avance/>
Avancé
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/elastic-tutorial/elastic/avance/fleet/ title="Bonus - Fleet & Elastic Agent" class=dd-item>
<a href=/elastic-tutorial/elastic/avance/fleet/>
Bonus - Fleet & Elastic Agent
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<section id=prefooter>
<hr>
<ul>
<li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li>
</ul>
</section>
<section id=footer>
<p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p>
</section>
</div>
</nav>
<section id=body>
<div id=overlay></div>
<div class="padding highlightable">
<div>
<div id=top-bar>
<div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb>
<span id=sidebar-toggle-span>
<a href=# id=sidebar-toggle data-sidebar-toggle>
<i class="fas fa-bars"></i>
</a>
</span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>
<a href=/elastic-tutorial/>Elastic Tutoriel</a> > <a href=/elastic-tutorial/elastic/>Elastic</a> > <a href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/>Elementaire</a> > Lab - Diagnostic
</span>
</div>
<div class=progress>
<div class=wrapper>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#résolution-du-problème-de-lindex-observability-time-series>Résolution du problème de l&rsquo;index &ldquo;observability-time-series&rdquo;.</a></li>
</ul>
</li>
<li><a href=#a-vous-de-jouez->A vous de jouez !</a></li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id=head-tags>
</div>
<div id=body-inner>
<h1>
Lab - Diagnostic
</h1>
<p>Vous êtes le nouvel administrateur d&rsquo;un cluster Elasticsearch à 3 nœuds. En prenant possession du cluster, vous constatez que plusieurs index sont dans un état jaune. Vos supérieurs vous demandent de donner la priorité au dépannage des problèmes d&rsquo;allocation d&rsquo;index avant toute autre tâche.</p>
<p>Lorsqu&rsquo;ils sont configurés correctement, les clusters Elasticsearch sont hautement disponibles et tolérants aux pannes. Cela ne signifie pas nécessairement qu&rsquo;ils sont imperméables aux pannes. L&rsquo;erreur humaine et la défaillance matérielle sont toujours possibles. Le dépannage des problèmes de disponibilité des données sur un système distribué peut être un défi. Prenons le temps de démystifier certaines routines de dépannage de base lorsque vous remarquez des index jaunes dans votre cluster Elasticsearch. Dans ce laboratoire pratique, vous aurez l&rsquo;occasion de :</p>
<ul>
<li>Utiliser les API _cat pour obtenir rapidement des informations vitales sur votre cluster.</li>
<li>utiliser l&rsquo;API _cluster/allocation/explain pour découvrir pourquoi un index est ou n&rsquo;est pas alloué</li>
<li>Utiliser l&rsquo;API _settings pour mettre rapidement à jour les paramètres d&rsquo;index.</li>
</ul>
<h3 id=résolution-du-problème-de-lindex-observability-time-series>Résolution du problème de l&rsquo;index &ldquo;observability-time-series&rdquo;.</h3>
<p>Utilisez l&rsquo;outil de console Kibana pour exécuter ce qui suit :</p>
<pre tabindex=0><code>GET _cat/indices?v
</code></pre><pre tabindex=0><code>health status index                                                    uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   metricbeat-7.17.0-2022.02.22-000001                      WBLcTqYORtS5LJyFttVBXQ   1   1     956609            0      1.8gb        915.3mb
green  open   apm-7.17.0-error-000001                                  TuCoez2IQP6xmRJl70TKvw   1   1       4994            0     19.9mb          9.9mb
yellow open   .ds-observability-time-series-2022.02.22-000002          xKbIQkulR0mMwv8aCbR5Og   1  10          1            0     12.5kb          4.1kb
yellow open   .ds-observability-time-series-2022.02.22-000001          i_sIi8P2SUu6mNmlsMjv3Q   1  10         16            0     19.6kb          6.5kb
green  open   apm-7.17.0-transaction-000001                            O14qvTcvQyOOIp8kIGGpKg   1   1     163280            0    130.7mb         62.3mb
green  open   apm-7.17.0-metric-000001                                 mXYNU6V9SU2tlAmODIjPHQ   1   1     265903            0       73mb         36.4mb
green  open   .apm-agent-configuration                                 jkaqvfq0Sy25CHaLDswUUA   1   1          0            0       452b           226b
green  open   apm-7.17.0-span-000001                                   iOVtWj8iRL6b-YbxROQ9ig   1   1     505334            0    377.8mb        153.4mb
green  open   apm-7.17.0-onboarding-2022.02.22                         dJ8FT0LvSn2HTUynoxWtbQ   1   1          1            0     16.1kb            8kb
green  open   apm-7.17.0-profile-000001                                dQEJ37KkSzmQr4DVKLQnAw   1   1          0            0       452b           226b
green  open   .security-7                                              o2VUY0seRxSefLHyOge4rQ   1   1         60            0    531.1kb        295.6kb
green  open   .ds-observability-time-series-2022.02.22-000001_restored _WQSy8o3QTi6l4inCqpA8Q   1   1         16            0     13.1kb          6.5kb
green  open   filebeat-7.17.0-2022.02.22-000001                        hN3UWBgXRYm9KA66iHfayQ   1   1    2453406            0      3.2gb          1.6gb
green  open   .kibana_7.17.0_001                                       J_lf9M3zRjmHgMdRhwcqLw   1   1       4439         1913      8.3mb          4.1mb
green  open   .apm-custom-link                                         fnAtCfqXSsOCN7dqyGQT8A   1   1          0            0       452b           226b
green  open   .ds-observability-time-series-2022.02.22-000002_restored SUVTggxqRMODlSz4pE3gEw   1   1          1            0      8.3kb          4.1kb
green  open   heartbeat-7.17.0-2022.02.22-000001                       U50p8dOMSz2jhWz7kHRDnw   1   1      25386            0     29.5mb         14.7mb
green  open   .async-search                                            JjeGtgVgTYKlJ8PsvmwL7Q   1   1          0            0      3.7kb           249b
green  open   .kibana_task_manager_7.17.0_001                          x63yGuhDSaudkMeqtmxANA   1   1         18        43080     15.2mb          7.6mb
</code></pre><pre tabindex=0><code>GET _cat/nodes?v
</code></pre><pre tabindex=0><code>ip         heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name
172.20.0.4           61          97  33    3.53    2.21     1.66 cdfhilmrstw *      es01
172.20.0.3           73          97  33    3.53    2.21     1.66 cdfhilmrstw -      es03
172.20.0.2           68          97  33    3.53    2.21     1.66 cdfhilmrstw -      es02
</code></pre><pre tabindex=0><code>GET _cluster/allocation/explain
</code></pre><pre tabindex=0><code>{
  &quot;note&quot; : &quot;No shard was specified in the explain API request, so this response explains a randomly chosen unassigned shard. There may be other unassigned shards in this cluster which cannot be assigned for different reasons. It may not be possible to assign this shard until one of the other shards is assigned correctly. To explain the allocation of other shards (whether assigned or unassigned) you must specify the target shard in the request to this API.&quot;,
  &quot;index&quot; : &quot;.ds-observability-time-series-2022.02.22-000001&quot;,
  &quot;shard&quot; : 0,
  &quot;primary&quot; : false,
  &quot;current_state&quot; : &quot;unassigned&quot;,
  &quot;unassigned_info&quot; : {
    &quot;reason&quot; : &quot;INDEX_CREATED&quot;,
    &quot;at&quot; : &quot;2022-02-22T16:18:00.719Z&quot;,
    &quot;last_allocation_status&quot; : &quot;no_attempt&quot;
  },
  &quot;can_allocate&quot; : &quot;no&quot;,
  &quot;allocate_explanation&quot; : &quot;cannot allocate because allocation is not permitted to any of the nodes&quot;,
  &quot;node_allocation_decisions&quot; : [
    {
      &quot;node_id&quot; : &quot;8T5zcuSbRbugyhTN5hxzHQ&quot;,
      &quot;node_name&quot; : &quot;es02&quot;,
      &quot;transport_address&quot; : &quot;172.20.0.2:9300&quot;,
      &quot;node_attributes&quot; : {
        &quot;ml.machine_memory&quot; : &quot;8312127488&quot;,
        &quot;ml.max_open_jobs&quot; : &quot;512&quot;,
        &quot;xpack.installed&quot; : &quot;true&quot;,
        &quot;ml.max_jvm_size&quot; : &quot;268435456&quot;,
        &quot;transform.node&quot; : &quot;true&quot;
      },
      &quot;node_decision&quot; : &quot;no&quot;,
      &quot;weight_ranking&quot; : 1,
      &quot;deciders&quot; : [
        {
          &quot;decider&quot; : &quot;same_shard&quot;,
          &quot;decision&quot; : &quot;NO&quot;,
          &quot;explanation&quot; : &quot;a copy of this shard is already allocated to this node [[.ds-observability-time-series-2022.02.22-000001][0], node[8T5zcuSbRbugyhTN5hxzHQ], [R], s[STARTED], a[id=rj9XVRi9Te2vqQgIIwsb8Q]]&quot;
        }
      ]
    },
    {
      &quot;node_id&quot; : &quot;QjZ5OxRQRxSGEq9fHq39ug&quot;,
      &quot;node_name&quot; : &quot;es01&quot;,
      &quot;transport_address&quot; : &quot;172.20.0.4:9300&quot;,
      &quot;node_attributes&quot; : {
        &quot;ml.machine_memory&quot; : &quot;8312127488&quot;,
        &quot;xpack.installed&quot; : &quot;true&quot;,
        &quot;transform.node&quot; : &quot;true&quot;,
        &quot;ml.max_open_jobs&quot; : &quot;512&quot;,
        &quot;ml.max_jvm_size&quot; : &quot;268435456&quot;
      },
      &quot;node_decision&quot; : &quot;no&quot;,
      &quot;weight_ranking&quot; : 2,
      &quot;deciders&quot; : [
        {
          &quot;decider&quot; : &quot;same_shard&quot;,
          &quot;decision&quot; : &quot;NO&quot;,
          &quot;explanation&quot; : &quot;a copy of this shard is already allocated to this node [[.ds-observability-time-series-2022.02.22-000001][0], node[QjZ5OxRQRxSGEq9fHq39ug], [R], s[STARTED], a[id=1Hb2K_nMTHqGP3LqlhDnjQ]]&quot;
        }
      ]
    },
    {
      &quot;node_id&quot; : &quot;g9m0hRGUS1isZhC9CVdhgw&quot;,
      &quot;node_name&quot; : &quot;es03&quot;,
      &quot;transport_address&quot; : &quot;172.20.0.3:9300&quot;,
      &quot;node_attributes&quot; : {
        &quot;ml.machine_memory&quot; : &quot;8312127488&quot;,
        &quot;ml.max_open_jobs&quot; : &quot;512&quot;,
        &quot;xpack.installed&quot; : &quot;true&quot;,
        &quot;ml.max_jvm_size&quot; : &quot;268435456&quot;,
        &quot;transform.node&quot; : &quot;true&quot;
      },
      &quot;node_decision&quot; : &quot;no&quot;,
      &quot;weight_ranking&quot; : 3,
      &quot;deciders&quot; : [
        {
          &quot;decider&quot; : &quot;same_shard&quot;,
          &quot;decision&quot; : &quot;NO&quot;,
          &quot;explanation&quot; : &quot;a copy of this shard is already allocated to this node [[.ds-observability-time-series-2022.02.22-000001][0], node[g9m0hRGUS1isZhC9CVdhgw], [P], s[STARTED], a[id=iwUIWrc0S5SSE2R52VK8Mg]]&quot;
        }
      ]
    }
  ]
}
</code></pre><h2 id=a-vous-de-jouez->A vous de jouez !</h2>
<p>Expliquer le problème que rencontre le cluster Elasticsearch et la solution que vous proposez pour corriger ce comportement.</p>
<footer class=footline>
</footer>
</div>
</div>
<div id=navigation>
<a class="nav nav-prev" href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/backup/ title="Lab - Backup & Restore"> <i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/elastic-tutorial/elastic/intermediare/ title=Intermediare style=margin-right:0><i class="fa fa-chevron-right"></i></a>
</div>
</section>
<div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px>
<div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div>
</div>
<script src=/elastic-tutorial/js/clipboard.min.js?1645973180></script>
<script src=/elastic-tutorial/js/perfect-scrollbar.min.js?1645973180></script>
<script src=/elastic-tutorial/js/perfect-scrollbar.jquery.min.js?1645973180></script>
<script src=/elastic-tutorial/js/jquery.sticky.js?1645973180></script>
<script src=/elastic-tutorial/js/featherlight.min.js?1645973180></script>
<script src=/elastic-tutorial/js/highlight.pack.js?1645973180></script>
<script>hljs.initHighlightingOnLoad()</script>
<script src=/elastic-tutorial/js/modernizr.custom-3.6.0.js?1645973180></script>
<script src=/elastic-tutorial/js/learn.js?1645973180></script>
<script src=/elastic-tutorial/js/hugo-learn.js?1645973180></script>
<script src=/elastic-tutorial/mermaid/mermaid.js?1645973180></script>
<script>mermaid.initialize({startOnLoad:!0})</script>
</body>
</html>