<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.105.0"><meta name=description content="Tutoriel sur Elastic"><meta name=author content="Maxime Calves"><link rel=icon href=/elastic-tutorial/images/favicon.png type=image/png><title>Lab - Uptime :: Elastic Tutoriel</title><link href=/elastic-tutorial/css/nucleus.css?1668509537 rel=stylesheet><link href=/elastic-tutorial/css/fontawesome-all.min.css?1668509537 rel=stylesheet><link href=/elastic-tutorial/css/hybrid.css?1668509537 rel=stylesheet><link href=/elastic-tutorial/css/featherlight.min.css?1668509537 rel=stylesheet><link href=/elastic-tutorial/css/perfect-scrollbar.min.css?1668509537 rel=stylesheet><link href=/elastic-tutorial/css/auto-complete.css?1668509537 rel=stylesheet><link href=/elastic-tutorial/css/atom-one-dark-reasonable.css?1668509537 rel=stylesheet><link href=/elastic-tutorial/css/theme.css?1668509537 rel=stylesheet><link href=/elastic-tutorial/css/tabs.css?1668509537 rel=stylesheet><link href=/elastic-tutorial/css/hugo-theme.css?1668509537 rel=stylesheet><link href=/elastic-tutorial/css/theme-blue.css?1668509537 rel=stylesheet><script src=/elastic-tutorial/js/jquery-3.3.1.min.js?1668509537></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/elastic-tutorial/elastic/d%C3%A9butant/lab_uptime/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><img src=../../../../elastic-tutorial/media/logo.png></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/elastic-tutorial/js/lunr.min.js?1668509537></script>
<script type=text/javascript src=/elastic-tutorial/js/auto-complete.js?1668509537></script>
<script type=text/javascript>var baseurl="https://maxime-cls.github.io/elastic-tutorial/"</script><script type=text/javascript src=/elastic-tutorial/js/search.js?1668509537></script></div><div class=highlightable><ul class=topics><li data-nav-id=/elastic-tutorial/elastic/ title=Elastic class="dd-item
parent"><a href=/elastic-tutorial/elastic/>Elastic
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/elastic-tutorial/elastic/prerequis/ title=Prérequis class=dd-item><a href=/elastic-tutorial/elastic/prerequis/>Prérequis
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/elastic-tutorial/elastic/prerequis/installation/ title=Installation class=dd-item><a href=/elastic-tutorial/elastic/prerequis/installation/>Installation
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/elastic-tutorial/elastic/d%C3%A9butant/ title=Débutant class="dd-item
parent"><a href=/elastic-tutorial/elastic/d%C3%A9butant/>Débutant
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/elastic-tutorial/elastic/d%C3%A9butant/lab_logs/ title="Lab - Logs" class=dd-item><a href=/elastic-tutorial/elastic/d%C3%A9butant/lab_logs/>Lab - Logs
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/d%C3%A9butant/lab_metrics/ title="Lab - Metrics" class=dd-item><a href=/elastic-tutorial/elastic/d%C3%A9butant/lab_metrics/>Lab - Metrics
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/d%C3%A9butant/lab_apm/ title="Lab - APM" class=dd-item><a href=/elastic-tutorial/elastic/d%C3%A9butant/lab_apm/>Lab - APM
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/d%C3%A9butant/lab_uptime/ title="Lab - Uptime" class="dd-item active"><a href=/elastic-tutorial/elastic/d%C3%A9butant/lab_uptime/>Lab - Uptime
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/ title=Elementaire class=dd-item><a href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/>Elementaire
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/security/ title="Lab - Habilitation" class=dd-item><a href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/security/>Lab - Habilitation
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/ilm/ title="Lab - Index Lifecycle Policy" class=dd-item><a href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/ilm/>Lab - Index Lifecycle Policy
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/backup/ title="Lab - Backup & Restore" class=dd-item><a href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/backup/>Lab - Backup & Restore
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/diagnostic/ title="Lab - Diagnostic" class=dd-item><a href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/diagnostic/>Lab - Diagnostic
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/elastic-tutorial/elastic/intermediare/ title=Intermediare class=dd-item><a href=/elastic-tutorial/elastic/intermediare/>Intermediare
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/elastic-tutorial/elastic/intermediare/alerting/ title="Lab - Alertes" class=dd-item><a href=/elastic-tutorial/elastic/intermediare/alerting/>Lab - Alertes
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/intermediare/index_alias/ title="Labs - Index et ALias" class=dd-item><a href=/elastic-tutorial/elastic/intermediare/index_alias/>Labs - Index et ALias
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/intermediare/mapping/ title="Labs - Mapping" class=dd-item><a href=/elastic-tutorial/elastic/intermediare/mapping/>Labs - Mapping
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/intermediare/template_mapping/ title="Labs - Index Template et Mapping" class=dd-item><a href=/elastic-tutorial/elastic/intermediare/template_mapping/>Labs - Index Template et Mapping
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/intermediare/reindex/ title="Labs - Reindex" class=dd-item><a href=/elastic-tutorial/elastic/intermediare/reindex/>Labs - Reindex
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/intermediare/crud_documents/ title="Labs - CRUD" class=dd-item><a href=/elastic-tutorial/elastic/intermediare/crud_documents/>Labs - CRUD
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/elastic-tutorial/elastic/avance/ title=Avancé class=dd-item><a href=/elastic-tutorial/elastic/avance/>Avancé
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/elastic-tutorial/elastic/avance/term/ title="Labs - Query niveau I" class=dd-item><a href=/elastic-tutorial/elastic/avance/term/>Labs - Query niveau I
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/avance/sort/ title="Labs - Query niveau II" class=dd-item><a href=/elastic-tutorial/elastic/avance/sort/>Labs - Query niveau II
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/avance/query/ title="Labs - Query niveau III" class=dd-item><a href=/elastic-tutorial/elastic/avance/query/>Labs - Query niveau III
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/avance/tp_query/ title="TP : Définir et exécuter des requêtes de recherche dans Elasticsearch" class=dd-item><a href=/elastic-tutorial/elastic/avance/tp_query/>TP : Définir et exécuter des requêtes de recherche dans Elasticsearch
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/elastic-tutorial/elastic/avance/fleet/ title="Bonus - Fleet & Elastic Agent" class=dd-item><a href=/elastic-tutorial/elastic/avance/fleet/>Bonus - Fleet & Elastic Agent
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li></ul><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/elastic-tutorial/>Elastic Tutoriel</a> > <a href=/elastic-tutorial/elastic/>Elastic</a> > <a href=/elastic-tutorial/elastic/d%C3%A9butant/>Débutant</a> > Lab - Uptime</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#déployer-un-agent-beats>Déployer un agent beats</a></li></ul></li><li><a href=#parcours-utilisateurs>Parcours utilisateurs</a></li><li><a href=#a-vous-de-jouez->A vous de jouez !</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Lab - Uptime</h1><p>Objectif : Dans ce laboratoire, vous explorerez la facilité avec laquelle vous pouvez obtenir des métriques des disponibilités des services avec Heratbeat et les indexer dans Elasticsearch. Vous explorerez également les tableaux de bord Kibana et verrez avec quelle facilité vous pouvez surveiller ces métriques.</p><h3 id=déployer-un-agent-beats>Déployer un agent beats</h3><p>Ajoutez le service <strong>Heartbeat</strong> à la suite du service <strong>Beats</strong></p><pre tabindex=0><code>vim beats/beats-docker.yml
</code></pre><p><strong>beats-docker.yml</strong></p><pre tabindex=0><code>version: &#39;2.2&#39;
services:
  filebeat:
    image: docker.elastic.co/beats/filebeat:${VERSION}
    container_name: filebeat
    restart: unless-stopped
    entrypoint: &#34;filebeat -e -strict.perms=false&#34;
    user: root
    volumes:
    - &#34;./conf/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro&#34;
    - &#34;/var/lib/docker/containers:/var/lib/docker/containers:ro&#34;
    - &#34;/var/run/docker.sock:/var/run/docker.sock:ro&#34;
    - &#34;/var/log:/tmp:ro&#34;
    - certs:$CERTS_DIR
    networks:
    - elastic
  metricbeat:
    image: docker.elastic.co/beats/metricbeat:${VERSION}
    container_name: metricbeat
    restart: unless-stopped
    entrypoint: &#34;metricbeat -e -strict.perms=false&#34;
    user: root
    volumes:
    - &#34;./conf/metricbeat.yml:/usr/share/metricbeat/metricbeat.yml:ro&#34;
    - &#34;/proc:/hostfs/proc:ro&#34;
    - &#34;/sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro&#34;
    - &#34;/:/hostfs:ro&#34;
    - &#34;/var/run/docker.sock:/var/run/docker.sock:ro&#34;
    - certs:$CERTS_DIR
    networks:
    - elastic
  heartbeat:
    image: docker.elastic.co/beats/heartbeat:${VERSION}
    container_name: heartbeat
    restart: unless-stopped
    entrypoint: &#34;heartbeat -e -strict.perms=false&#34;
    user: heartbeat
    volumes:
    - &#34;./conf/heartbeat.yml:/usr/share/heartbeat/heartbeat.yml:ro&#34;
    - &#34;/var/run/docker.sock:/var/run/docker.socki:ro&#34;
    - certs:$CERTS_DIR
    networks:
    - elastic


volumes:
  certs:
    driver: local

networks:
  elastic:
    name: elastic
    driver: bridge
</code></pre><pre tabindex=0><code>vim beats/conf/heartbeat.yml
</code></pre><pre tabindex=0><code>heartbeat.monitors:
- type: http
  id: nginx-service-status
  name: Nginx Status
  schedule: &#39;@every 10s&#39;
  urls:
    - http://nginx:8081
  timeout: 30s
  check.response:
    status: 200
    body:
      - &#34;Welcome&#34;
- type: http
  id: petclinic-service-status
  name: Petclinic Status
  schedule: &#39;@every 10s&#39;
  urls:
      - http://petclinic:8080/metrics/prometheus
  timeout: 30s
  check.response:
    status: 200
    body:
      - &#34;jvm_memory_committed_bytes&#34;
- type: tcp
  id: mysql-service-status
  name: MySQL Status
  schedule: &#39;@every 10s&#39;
  hosts: [&#34;tcp://mysql:3306&#34;]

processors:
- add_cloud_metadata: ~
- add_docker_metadata: ~

output.elasticsearch:
  hosts: &#39;https://es01:9200&#39;
  username: &#34;elastic&#34;
  password: &#34;CHANGEME&#34;
  ssl.certificate_authorities: [&#34;/usr/share/elasticsearch/config/certificates/ca/ca.crt&#34;]
</code></pre><p>Changer la valeur du champs <strong>password</strong> avec la valeur du mot de passe générer automatiquement.</p><pre tabindex=0><code>docker compose -f beats/beats-docker.yml up -d
</code></pre><pre tabindex=0><code>vim app/artificial_load.sh
</code></pre><pre tabindex=0><code>#!/bin/bash

COUNTER=0

while [  $COUNTER -lt 10000 ] ;
do
 curl -s --header &#34;X-Forwarded-For: 5.198.223.255&#34; localhost &gt; /dev/null
 curl -s localhost/owners/find &gt; /dev/null
 curl -s localhost/owners?lastName= &gt; /dev/null
 curl -s localhost/owners/1 &gt; /dev/null
 curl -s localhost/owners/4 &gt; /dev/null
 curl -s localhost/owners/6 &gt; /dev/null
 curl -s localhost/owners/8 &gt; /dev/null
 curl -s localhost/vets.html &gt; /dev/null
 curl -s localhost/oups &gt; /dev/null
 let COUNTER=COUNTER+1
done
</code></pre><pre tabindex=0><code>chmod +x app/artificial_load.sh
</code></pre><p>Maintenant, ouvrez une nouvelle fenêtre de terminal et exécutez le script suivant pour simuler la charge sur votre serveur NGINX.</p><pre tabindex=0><code>./app/artificial_load.sh
</code></pre><p>Naviguer dans l&rsquo;application Petclinic quelque instant pour générer un traffic utilisateur sur un navigateur web.</p><p>Lancez Kibana pour commencer à explorer les tableaux de bord qui ont été inclus dans le menu <strong>Observability</strong></p><p>Cliquez sur le bouton <strong>View app</strong></p><p><img src=/elastic-tutorial/images/attachments/debutant/observability_uptime.png alt=image.png></p><p>Vous pouvez observer que l&rsquo;agent beat réalise 3 vérification de disponibilité. Un pour chaque service de l&rsquo;application.</p><p>Cliquez sur le monitor <strong>Nginx Status</strong></p><p><img src=/elastic-tutorial/images/attachments/debutant/uptime_monitors.png alt=image.png></p><p>Vous avez maintenant un vue détaillée du service nginx comme les temps de réponses, la disponibilité, etc&mldr;</p><p><img src=/elastic-tutorial/images/attachments/debutant/uptime_nginx_monitor.png alt=image.png></p><h2 id=parcours-utilisateurs>Parcours utilisateurs</h2><p>L&rsquo;agent Hearbeat permet de simuler un parcours utilisateur via un navigateur. Ce type de vérification permet de valider en tout temps les scénarios d&rsquo;un site web.</p><p>Modifiez la configuration de l&rsquo;agent Heratbeat</p><pre tabindex=0><code>vim beats/conf/heartbeat.yml
</code></pre><p>Ajouter les tests de navigation et modifier les URLs indiquer en localhost par l&rsquo;adresse IP de votre machine. <code>http://localhost:8081/</code> en <code>http://IP_MACHINE:8081/</code></p><pre tabindex=0><code>- type: browser
  id: home2edit-monitor
  name: Home -&gt; Edit Owner journey
  schedule: &#34;@every 10s&#34;
  source:
    inline:
      script: |-
        step(&#34;load homepage&#34;, async () =&gt; {
            await page.goto(&#39;http://localhost:8081/&#39;);
            await page.waitForRequest(/intake/);
        });
        step(&#34;click on find owners&#34;, async () =&gt; {
            await page.click(&#39;#main-navbar &gt; ul &gt; li:nth-child(3) &gt; a&#39;);
            await page.waitForRequest(/intake/);
        });
        step(&#34;click on find owners button&#34;, async () =&gt; {
            await page.click(&#39;#search-owner-form &gt; div:nth-child(2) &gt; div &gt; button&#39;);
            await page.waitForRequest(/intake/);
        });
        step(&#34;click on Eduardo Rodriguez&#34;, async () =&gt; {
            await page.click(&#39;#vets &gt; tbody &gt; tr:nth-child(3) &gt; td:nth-child(1) &gt; a&#39;);
            await page.waitForRequest(/intake/);
        });
        step(&#34;click on edit owner button&#34;, async () =&gt; {
            await page.click(&#39;body &gt; div.container-fluid &gt; div &gt; a:nth-child(3)&#39;);
            await page.waitForRequest(/intake/);
        });

- type: browser
  id: home2vets-monitor
  name: Home -&gt; Show Vets journey
  schedule: &#34;@every 10s&#34;
  source:
    inline:
      script: |-
        step(&#34;load homepage&#34;, async () =&gt; {
            await page.goto(&#39;http://localhost:8081/&#39;);
            await page.waitForRequest(/intake/);
        });
        step(&#34;click on vets&#34;, async () =&gt; {
            await page.click(&#39;#main-navbar &gt; ul &gt; li:nth-child(4) &gt; a&#39;);
            await page.waitForRequest(/intake/);
        });

- type: browser
  id: home2addpet-monitor
  name: Home -&gt; Add Owner journey
  schedule: &#34;@every 10s&#34;
  source:
    inline:
      script: |-
        step(&#34;load homepage&#34;, async () =&gt; {
            await page.goto(&#39;http://localhost:8081/&#39;);
            await page.waitForRequest(/intake/);
        });
        step(&#34;click on find owners&#34;, async () =&gt; {
            await page.click(&#39;#main-navbar &gt; ul &gt; li:nth-child(3) &gt; a&#39;);
            await page.waitForRequest(/intake/);
        });
        step(&#34;click on add Owner button&#34;, async () =&gt; {
            await page.click(&#39;body &gt; div.container-fluid &gt; div &gt; a&#39;);
            await page.waitForRequest(/intake/);
        });

- type: browser
  id: error-monitor
  name: Home -&gt; Error journey
  schedule: &#34;@every 10s&#34;
  source:
    inline:
      script: |-
        step(&#34;load homepage&#34;, async () =&gt; {
            await page.goto(&#39;http://localhost:8081/&#39;);
            await page.waitForRequest(/intake/);
        });
        step(&#34;click on error&#34;, async () =&gt; {
            await page.click(&#39;#main-navbar &gt; ul &gt; li:nth-child(5) &gt; a&#39;);
            await page.waitForRequest(/intake/);
</code></pre><p>Vous pouvez naviguer dans l&rsquo;interface Kibana Uptime pour visualiser les parcours utilisateurs :</p><p><img src=/elastic-tutorial/images/attachments/debutant/uptime_browser_monitors.png alt=image.png></p><p>Vous pouvez naviguer le parcours utilisateur <strong>Home -> Show Vets journey - inline</strong> pour visualiser les données de performances ainsi ques des captures d&rsquo;écran :</p><p><img src=/elastic-tutorial/images/attachments/debutant/monitor_browser_vets.png alt=image.png></p><h2 id=a-vous-de-jouez->A vous de jouez !</h2><p>On peut constater au travers des autres parcours utilisateurs que l&rsquo;application n&rsquo;a pas le comportement attendu. Proposer moi une analyse permettant de comprendre l&rsquo;origine du problème grace a la solution Elastic.
Et proposer moi une solution pour corriger le dysfonctionnement.</p><p>Résumé : Dans ce laboratoire, vous avez exploré la facilité avec laquelle vous pouvez obtenir des mesures des vos services liée à l&rsquo;application Petclinic avec Heartbeat et les indexer dans Elasticsearch. Vous avez également exploré les tableaux de bord Kibana et vu avec quelle facilité vous pouvez surveiller ces mesures.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/elastic-tutorial/elastic/d%C3%A9butant/lab_apm/ title="Lab - APM"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/elastic-tutorial/elastic/%C3%A9l%C3%A9mentaire/ title=Elementaire style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/elastic-tutorial/js/clipboard.min.js?1668509537></script>
<script src=/elastic-tutorial/js/perfect-scrollbar.min.js?1668509537></script>
<script src=/elastic-tutorial/js/perfect-scrollbar.jquery.min.js?1668509537></script>
<script src=/elastic-tutorial/js/jquery.sticky.js?1668509537></script>
<script src=/elastic-tutorial/js/featherlight.min.js?1668509537></script>
<script src=/elastic-tutorial/js/highlight.pack.js?1668509537></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/elastic-tutorial/js/modernizr.custom-3.6.0.js?1668509537></script>
<script src=/elastic-tutorial/js/learn.js?1668509537></script>
<script src=/elastic-tutorial/js/hugo-learn.js?1668509537></script>
<script src=/elastic-tutorial/mermaid/mermaid.js?1668509537></script>
<script>mermaid.initialize({startOnLoad:!0})</script></body></html>